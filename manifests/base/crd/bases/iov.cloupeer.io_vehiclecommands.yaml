---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: vehiclecommands.iov.cloupeer.io
spec:
  group: iov.cloupeer.io
  names:
    kind: VehicleCommand
    listKind: VehicleCommandList
    plural: vehiclecommands
    singular: vehiclecommand
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Target Vehicle Name
      jsonPath: .spec.vehicleName
      name: Vehicle
      type: string
    - description: Command Type
      jsonPath: .spec.command
      name: Type
      type: string
    - description: Command Phase
      jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: VehicleCommand is the Schema for the vehiclecommands API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VehicleCommandSpec defines the desired state of VehicleCommand
            properties:
              command:
                description: Command is the type of operation to perform.
                enum:
                - OTA
                - Reboot
                type: string
              parameters:
                additionalProperties:
                  type: string
                description: |-
                  Parameters contains optional arguments for the command.
                  For OTA, this might include "TargetVersion".
                type: object
              vehicleName:
                description: VehicleName is the name of the target Vehicle resource
                  in the same namespace.
                minLength: 1
                type: string
            required:
            - command
            - vehicleName
            type: object
          status:
            description: VehicleCommandStatus defines the observed state of VehicleCommand
            properties:
              acknowledgeTime:
                description: AcknowledgeTime is the timestamp when the device confirmed
                  receipt.
                format: date-time
                type: string
              completionTime:
                description: CompletionTime is the timestamp when the command finished
                  (success or fail).
                format: date-time
                type: string
              conditions:
                description: |-
                  Conditions allow extensibility for specific command types (e.g. OTA steps).
                  For an OTA command, this might contain "Downloaded", "Installed".
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastUpdateTime:
                description: LastUpdateTime is the timestamp of the last status update.
                format: date-time
                type: string
              message:
                description: Message provides human-readable details about the current
                  status or error.
                type: string
              phase:
                description: Phase represents the current lifecycle stage of the command.
                type: string
              startTime:
                description: StartTime is the timestamp when the actual execution
                  started (e.g. user clicked upgrade).
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: false
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: Target Vehicle
      jsonPath: .spec.vehicleName
      name: Vehicle
      type: string
    - description: Command Method
      jsonPath: .spec.method
      name: Method
      type: string
    - description: Command Phase
      jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: VehicleCommand is the Schema for the vehiclecommands API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VehicleCommandSpec defines the desired command execution.
            properties:
              method:
                description: Method is the name of the operation to execute (e.g.,
                  "Reboot", "OTA", "OpenTrunk").
                minLength: 1
                type: string
              parameters:
                additionalProperties:
                  type: string
                description: |-
                  Parameters contains the input arguments for the method.
                  We use map[string]string for consistency with Vehicle.Spec.Properties.
                  Complex JSON values should be serialized as strings.
                type: object
              priority:
                description: |-
                  Priority defines the urgency of the command.
                  0: Low (Background, e.g. Log Upload)
                  1: Normal (Default, e.g. OTA)
                  2: High (User Interactive, e.g. Remote Unlock)
                  Controller/CloudHub should prioritize processing High priority commands.
                format: int32
                maximum: 2
                minimum: 0
                type: integer
              requestID:
                description: |-
                  RequestID allow external systems (like BFF) to trace the command.
                  Ideally maps to OpenTelemetry TraceID or a UUID.
                type: string
              timeoutSeconds:
                description: |-
                  TimeoutSeconds defines the maximum time allowed for the command to complete
                  once it reaches the "Sent" phase. If exceeded, the controller marks it as Failed/Timeout.
                format: int32
                minimum: 1
                type: integer
              vehicleName:
                description: VehicleName is the name of the target Vehicle resource
                  in the same namespace.
                minLength: 1
                type: string
            required:
            - method
            - vehicleName
            type: object
          status:
            description: VehicleCommandStatus defines the observed state of VehicleCommand.
            properties:
              acknowledgeTime:
                description: |-
                  AcknowledgeTime marks when the Vehicle Agent confirmed receipt of the command (PUBACK or equivalent).
                  Comparing (AcknowledgeTime - SentTime) reveals the network latency and connectivity health.
                format: date-time
                type: string
              completionTime:
                description: |-
                  CompletionTime marks when the command reached a terminal state (Succeeded, Failed, or Timeout).
                  This timestamp effectively closes the SLA window for the operation.
                format: date-time
                type: string
              conditions:
                description: Conditions provide a detailed history of the command's
                  progress (e.g., Downloaded, Verified).
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastUpdateTime:
                description: |-
                  LastUpdateTime captures the timestamp of the most recent status change.
                  Useful for detecting stalled commands or debugging controller latency.
                format: date-time
                type: string
              message:
                description: Message provides human-readable details about the current
                  status or error reason.
                type: string
              phase:
                description: Phase represents the current high-level stage of the
                  command lifecycle.
                enum:
                - Pending
                - Sent
                - Acknowledged
                - Running
                - Succeeded
                - Failed
                - Timeout
                type: string
              result:
                additionalProperties:
                  type: string
                description: |-
                  Result holds the output data.
                  WARNING: Do NOT store large binaries or logs here.
                  Use strictly for references (e.g., {"status": "ok", "report_url": "s3://bucket/log.txt"}).
                  Etcd limit is 1.5MB, keeping this small is crucial.
                type: object
              sentTime:
                description: |-
                  SentTime records the exact moment when the command was successfully published to the MQTT broker (EMQX).
                  Comparing (SentTime - StartTime) reveals the internal processing latency of the CloudHub.
                format: date-time
                type: string
              startTime:
                description: StartTime is when the controller first saw the command.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
