syntax = "proto3";

package v1;

option go_package = "cloupeer.io/cloupeer/api/proto/v1";

// HubService defines the RPC interface for the Cloupeer Hub.
service HubService {
  // SendCommand transmits a command from the Controller to the Hub.
  // The Hub is then responsible for forwarding this to the target vehicle (e.g. via MQTT).
  rpc SendCommand (SendCommandRequest) returns (SendCommandResponse) {}
}

// SendCommandRequest mirrors the VehicleCommand CRD spec.
message SendCommandRequest {
  // K8s CRD Name, used as the unique Trace ID.
  string command_name = 1;

  // The unique identifier of the vehicle (usually the Vehicle CR name).
  string vehicle_id = 2;
  
  // The type of command (e.g., "OTA", "Reboot").
  string command_type = 3;
  
  // Optional parameters for the command.
  map<string, string> parameters = 4;
}

message SendCommandResponse {
  // Indicates if the Hub successfully accepted the command for delivery.
  bool accepted = 1;
  
  // Human-readable message, useful for debugging or status updates.
  string message = 2;
}

// AgentCommand defines the standard message format exchanged between Hub and Agent via MQTT.
message AgentCommand {
  // Unique identifier for the command trace.
  string command_name = 1 [json_name = "commandName"];

  // Type of the command (e.g., "OTA", "Reboot").
  string command_type = 2 [json_name = "commandType"];

  // Parameters for the command execution.
  map<string, string> parameters = 3;

  // Timestamp when the command was issued (Unix timestamp).
  int64 timestamp = 4;
}

// Edge -> Cloud
message AgentCommandStatus {
  string command_name = 1 [json_name = "commandName"];
  
  // 状态枚举: "Received", "Running", "Succeeded", "Failed"
  string status = 2 [json_name = "status"];
  
  // 附加信息 (例如错误原因)
  string message = 3 [json_name = "message"];
}

message GetFirmwareURLRequest {
  // Vehicle ID
  string vehicle_id = 1 [json_name = "vehicleID"];
  
  // The version requested (e.g. from the OTA command parameters)
  string desired_version = 2 [json_name = "desiredVersion"];
  
  // Unique request ID for correlation (e.g. UUID)
  string request_id = 3 [json_name = "requestID"];
}

message GetFirmwareURLResponse {
  // Corresponds to the request_id
  string request_id = 1 [json_name = "requestID"];
  
  // The download URL
  string download_url = 2 [json_name = "downloadURL"];
  
  // Error message if any
  string error_message = 3 [json_name = "errorMessage"];
}

// RegisterVehicleRequest is sent by the Agent when it comes online.
message RegisterVehicleRequest {
  // The unique identifier of the vehicle.
  string vehicle_id = 1 [json_name = "vehicleID"];

  // The current firmware version running on the vehicle.
  string firmware_version = 2 [json_name = "firmwareVersion"];

  // (Optional) A human-readable description or model info.
  string description = 3 [json_name = "description"];
  
  // Timestamp of registration
  int64 timestamp = 4 [json_name = "timestamp"];
}
